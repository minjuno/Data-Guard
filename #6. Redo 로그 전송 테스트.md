# Redo 로그 전송 테스트

### **Standby 복구 적용**

```sql
alter database flashback on;

alter database recover managed standby database disconnect;

# MRP(Media Recovery Process) 가 떠있는지 확인
select process, status from v$managed_standby;
PROCESS   STATUS
--------- ------------
ARCH      CONNECTED
DGRD      ALLOCATED
DGRD      ALLOCATED
ARCH      CONNECTED
ARCH      CONNECTED
ARCH      CONNECTED
**MRP0      WAIT_FOR_LOG**
DGRD      ALLOCATED
```

### **로그 전송 테스트**

**primary에서 아카이브 로그 확인 후 로그 스위치 발생**

```sql
#primary
select status from v$instance;

STATUS
------------
MOUNTED

alter database open;

ALTER SESSION SET nls_date_format='DD-MON-YYYY HH24:MI:SS';

SELECT sequence#, first_time, next_time
FROM   v$archived_log
ORDER BY sequence#;

 SEQUENCE# FIRST_TIME           NEXT_TIME
---------- -------------------- --------------------
        15 21-OCT-2025 17:44:25 21-OCT-2025 17:47:42
        16 21-OCT-2025 17:47:42 21-OCT-2025 18:10:43
        17 21-OCT-2025 18:10:43 21-OCT-2025 18:25:41
        17 21-OCT-2025 18:10:43 21-OCT-2025 18:25:41
        18 21-OCT-2025 18:25:41 21-OCT-2025 18:25:57

ALTER SYSTEM SWITCH LOGFILE;
```

**Standy에 적용된 아카이브 로그 확인**

```bash
#standby 
ALTER SESSION SET nls_date_format='DD-MON-YYYY HH24:MI:SS';

SELECT sequence#, first_time, next_time, applied
FROM   v$archived_log
ORDER BY sequence#;

 SEQUENCE# FIRST_TIME           NEXT_TIME            APPLIED
---------- -------------------- -------------------- ---------
        17 21-OCT-2025 18:10:43 21-OCT-2025 18:25:41 YES
        18 21-OCT-2025 18:25:41 21-OCT-2025 18:25:57 YES
        19 21-OCT-2025 18:25:57 21-OCT-2025 18:26:12 IN-MEMORY
```

### **검증**

**Primary db open**

```sql
# primary, standby 각각 데이터파일 수 확인
select name from v$datafile;

export ORACLE_SID=PROD

sqlplus / as sysdba

select status from v$instance;

STATUS
------------
MOUNTED

alter database open;

# role 확인
select open_mode, database_role 
from   v$database;

OPEN_MODE            DATABASE_ROLE
-------------------- ----------------
READ WRITE           PRIMARY
```

**Primary에서 테이블스페이스 생성**

```sql
create tablespace ts9000
   datafile '/u01/app/oracle/oradata/PROD/disk2/ts9000.dbf' size 10m;
```

**Real-time apply가 아니고 acrhive log를 적용시키도록 했으므로 로그 스위치 수동 발생**

```sql
alter system switch logfile;
alter system switch logfile;
alter system checkpoint;
```

**standby에 생성된 테이블스페이스 확인**

```sql
select name from v$datafile;
```
